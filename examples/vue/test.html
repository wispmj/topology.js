<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>菜鸟教程(runoob.com)</title>
    <script type="text/javascript" src="../lib/fabric.js"></script>
  </head>

  <body>
    <canvas
      id="myCanvas"
      width="1800"
      height="1800"
      style="border: 1px solid #d3d3d3"
    >
      您的浏览器不支持 HTML5 canvas 标签。
    </canvas>
    <script>
      var rect1 = {
        x: 200,
        y: 200,
        ex: 300,
        ey: 500,
        width: 100,
        height: 300,
        cx: 250,
        cy: 350,
      };

      var rect2 = {
        x: 400,
        y: 400,
        ex: 500,
        ey: 700,
        width: 100,
        height: 300,
        cx: 450,
        cy: 550,
      };

      var o2 = {
        x: 300,
        y: 400,
      };

      var rotateAngle = 30;

      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");

      function draw1(rect) {
        // 红色矩形
        ctx.beginPath();
        ctx.strokeStyle = "blue";
        ctx.rect(rect.x, rect.y, rect.width, rect.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(300, 400);
        ctx.arc(300, 400, 5, 0, Math.PI * 2, true);
        ctx.fill();
        ctx.stroke();
        //中间线
        ctx.beginPath();
        ctx.strokeStyle = "black";
        ctx.setLineDash([5, 10]);
        ctx.moveTo(0, rect.cy);
        ctx.lineTo(rect.x * 2 + rect.width, rect.cy);
        ctx.moveTo(rect.cx, 0);
        ctx.lineTo(rect.cx, rect.y * 2 + rect.height);
        ctx.stroke();
        ctx.save();

        ctx.restore();
        ctx.setLineDash([]);
        ctx.beginPath();
        rotate(ctx, -rotateAngle, rect.cx, rect.cy, rect.x, rect.y);
        ctx.translate(0, rect.y + rect.ey);
        ctx.scale(1, -1);
        ctx.strokeStyle = "red";
        ctx.rect(rect.x, rect.y, rect.width, rect.height);
        ctx.stroke();
      }

      function draw2(rect) {
        debugger;
        ctx.restore();

        ctx.beginPath();
        ctx.strokeStyle = "green";

        var ori = new fabric.Point(o2.x, o2.y);
        var pt = new fabric.Point(rect2.cx, rect2.cy);
        // var pt1 = window.fabric.util.rotatePoint(pt,ori,rotateAngle);

        var vector = new fabric.Point(rect2.cx - o2.x, rect2.cy - o2.y);

        

        // fabric.util.rotateVector(vector, (rotateAngle / 180) * Math.PI);

        ctx.rect(rect.x, rect.y, rect.width, rect.height);
        ctx.stroke();
      }

      function rotate(ctx, ang, cx, cy, x, y) {
        ctx.translate(cx, cy);
        ctx.rotate((Math.PI * ang) / 180);
        ctx.translate(-cx, -cy);
      }

      draw1(rect2);

      draw2(rect2);
    </script>
  </body>
</html>
